<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeFinder Wien üéÅ Gratis Deals</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 16px; padding-bottom: 100px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; font-size: 28px; margin-bottom: 8px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 16px; font-size: 14px; }
        
        /* STREAK BANNER */
        .streak-banner { background: linear-gradient(135deg, #f59e0b, #ef4444); border-radius: 16px; padding: 16px; margin-bottom: 16px; color: white; display: flex; align-items: center; gap: 16px; cursor: pointer; transition: transform 0.2s; }
        .streak-banner:hover { transform: scale(1.02); }
        .streak-fire { font-size: 40px; animation: firePulse 1s infinite; }
        @keyframes firePulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .streak-info { flex: 1; }
        .streak-days { font-size: 24px; font-weight: 800; }
        .streak-text { font-size: 13px; opacity: 0.9; }
        .streak-reward { background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 13px; }
        
        /* DEAL DES TAGES */
        .daily-deal { background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 16px; padding: 20px; margin-bottom: 16px; color: white; position: relative; overflow: hidden; }
        .daily-deal::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); animation: shimmer 3s infinite; }
        @keyframes shimmer { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } }
        .daily-label { background: #fbbf24; color: #1f2937; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; display: inline-block; margin-bottom: 12px; }
        .daily-title { font-size: 22px; font-weight: 800; margin-bottom: 8px; }
        .daily-desc { opacity: 0.9; margin-bottom: 12px; }
        .daily-countdown { display: flex; gap: 8px; margin-top: 12px; }
        .countdown-box { background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 10px; text-align: center; }
        .countdown-num { font-size: 20px; font-weight: 800; }
        .countdown-label { font-size: 10px; opacity: 0.8; }
        .daily-btn { background: white; color: #667eea; border: none; padding: 12px 24px; border-radius: 25px; font-weight: 700; cursor: pointer; margin-top: 12px; }
        .daily-btn:hover { transform: scale(1.05); }
        
        /* SPAR-TRACKER */
        .savings-card { background: linear-gradient(135deg, #10b981, #059669); border-radius: 16px; padding: 16px; margin-bottom: 16px; color: white; }
        .savings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .savings-title { font-size: 14px; opacity: 0.9; }
        .savings-amount { font-size: 32px; font-weight: 800; }
        .savings-bar { background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px; overflow: hidden; }
        .savings-progress { background: white; height: 100%; border-radius: 4px; transition: width 0.5s; }
        .savings-goal { display: flex; justify-content: space-between; font-size: 12px; margin-top: 8px; opacity: 0.8; }
        
        /* LEVEL BAR */
        .level-bar { background: white; border-radius: 14px; padding: 12px 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; align-items: center; gap: 12px; }
        .level-badge { background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; }
        .level-info { flex: 1; }
        .level-name { font-weight: 600; font-size: 14px; color: #374151; }
        .level-xp-bar { background: #e5e7eb; height: 6px; border-radius: 3px; margin-top: 4px; overflow: hidden; }
        .level-xp-fill { background: linear-gradient(90deg, #8b5cf6, #6366f1); height: 100%; border-radius: 3px; transition: width 0.3s; }
        .level-xp-text { font-size: 11px; color: #9ca3af; margin-top: 2px; }
        .xp-popup { position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 12px 24px; border-radius: 30px; font-weight: 700; z-index: 1000; animation: xpFloat 1.5s forwards; pointer-events: none; }
        @keyframes xpFloat { 0% { opacity: 1; transform: translateX(-50%) translateY(0); } 100% { opacity: 0; transform: translateX(-50%) translateY(-50px); } }
        
        /* CHALLENGE */
        .challenge-card { background: white; border-radius: 14px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 2px solid #fbbf24; }
        .challenge-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .challenge-icon { font-size: 28px; }
        .challenge-title { font-weight: 700; color: #1f2937; }
        .challenge-subtitle { font-size: 12px; color: #6b7280; }
        .challenge-progress { display: flex; gap: 8px; margin-top: 12px; }
        .challenge-dot { width: 32px; height: 32px; border-radius: 50%; background: #e5e7eb; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: all 0.3s; }
        .challenge-dot.done { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .challenge-dot.current { background: #fbbf24; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(251,191,36,0.4); } 50% { box-shadow: 0 0 0 10px rgba(251,191,36,0); } }
        .challenge-reward { background: #fef3c7; padding: 10px; border-radius: 10px; margin-top: 12px; display: flex; align-items: center; gap: 8px; font-size: 13px; color: #92400e; }
        
        /* SPIN BANNER */
        .spin-banner { background: linear-gradient(135deg, #ec4899, #8b5cf6); border-radius: 16px; padding: 16px; margin-bottom: 16px; color: white; display: flex; align-items: center; gap: 16px; cursor: pointer; }
        .spin-banner:hover { transform: scale(1.02); }
        .spin-wheel { font-size: 36px; animation: spinSlow 10s linear infinite; }
        @keyframes spinSlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spin-info { flex: 1; }
        .spin-title { font-weight: 700; font-size: 16px; }
        .spin-text { font-size: 13px; opacity: 0.9; }
        .spin-btn { background: white; color: #8b5cf6; padding: 10px 20px; border-radius: 25px; border: none; font-weight: 700; cursor: pointer; }
        .spin-used { opacity: 0.6; cursor: not-allowed; }
        
        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 500; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-overlay.show { display: flex; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal { background: white; border-radius: 24px; padding: 24px; max-width: 340px; width: 100%; text-align: center; animation: slideUp 0.3s; position: relative; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .wheel-container { position: relative; width: 260px; height: 260px; margin: 20px auto; }
        .wheel { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#ef4444 0deg 45deg, #f59e0b 45deg 90deg, #10b981 90deg 135deg, #3b82f6 135deg 180deg, #8b5cf6 180deg 225deg, #ec4899 225deg 270deg, #06b6d4 270deg 315deg, #84cc16 315deg 360deg); transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99); box-shadow: 0 0 20px rgba(0,0,0,0.2); }
        .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 30px; z-index: 10; }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .spin-result { margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; display: none; }
        .spin-result.show { display: block; animation: bounceIn 0.5s; }
        @keyframes bounceIn { 0% { transform: scale(0.5); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .spin-result-text { font-size: 18px; font-weight: 700; color: #92400e; }
        .modal-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 14px 32px; border-radius: 25px; font-weight: 700; font-size: 16px; cursor: pointer; margin-top: 16px; }
        .modal-btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .modal-close { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 24px; cursor: pointer; color: #9ca3af; }
        
        /* SECRET DEAL */
        .secret-deal { background: linear-gradient(135deg, #1f2937, #374151); border-radius: 16px; padding: 16px; margin-bottom: 16px; color: white; position: relative; overflow: hidden; }
        .secret-deal.locked::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.03) 10px, rgba(255,255,255,0.03) 20px); }
        .secret-header { display: flex; align-items: center; gap: 12px; }
        .secret-icon { font-size: 32px; }
        .secret-title { font-weight: 700; }
        .secret-desc { font-size: 13px; opacity: 0.8; margin-top: 4px; }
        .secret-progress { margin-top: 12px; }
        .secret-bar { background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden; }
        .secret-fill { background: linear-gradient(90deg, #fbbf24, #f59e0b); height: 100%; border-radius: 4px; transition: width 0.5s; }
        .secret-text { font-size: 12px; margin-top: 6px; opacity: 0.7; }
        .secret-unlocked { background: linear-gradient(135deg, #fbbf24, #f59e0b) !important; }
        
        /* UPDATE COUNTDOWN */
        .update-countdown { background: white; border-radius: 14px; padding: 12px 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; color: #6b7280; }
        .update-countdown span { color: #667eea; font-weight: 700; }
        
        /* SEARCH & FILTERS */
        .search-box { background: white; border-radius: 14px; padding: 14px 18px; display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin: 16px 0; position: relative; }
        .search-box input { flex: 1; border: none; outline: none; font-size: 16px; background: transparent; }
        .search-box svg { width: 20px; height: 20px; color: #999; }
        .search-box .clear-btn { background: #e5e7eb; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; display: none; align-items: center; justify-content: center; font-size: 12px; color: #666; }
        .search-box .clear-btn.show { display: flex; }
        .search-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: white; border-radius: 14px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); margin-top: 8px; display: none; z-index: 200; overflow: hidden; }
        .search-dropdown.show { display: block; }
        .search-section { padding: 12px 16px; border-bottom: 1px solid #f1f5f9; }
        .search-section-title { font-size: 11px; font-weight: 700; color: #94a3b8; text-transform: uppercase; margin-bottom: 8px; }
        .search-tag { display: inline-flex; align-items: center; gap: 4px; background: #f1f5f9; padding: 6px 12px; border-radius: 20px; font-size: 13px; cursor: pointer; margin: 4px; }
        .search-tag:hover { background: #e2e8f0; }
        .search-tag.trending { background: linear-gradient(135deg, #fef3c7, #fde68a); }
        .filters { background: white; border-radius: 14px; padding: 12px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); position: sticky; top: 0; z-index: 100; }
        .filters.scrolled { box-shadow: 0 4px 20px rgba(0,0,0,0.12); }
        .filter-row { display: flex; gap: 8px; overflow-x: auto; padding: 4px 0; scrollbar-width: none; }
        .filter-row::-webkit-scrollbar { display: none; }
        .filter-btn { background: #f1f5f9; border: none; padding: 10px 16px; border-radius: 25px; font-size: 14px; white-space: nowrap; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .filter-btn:hover { background: #e2e8f0; }
        .filter-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .filter-count { background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 10px; font-size: 12px; }
        .filter-divider { height: 1px; background: #e5e7eb; margin: 8px 0; }
        
        /* DEAL CARDS */
        .deal-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 2px solid transparent; transition: all 0.2s; }
        .deal-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .deal-card.hot { border-color: #f59e0b; }
        @keyframes highlightDeal { 0%, 100% { box-shadow: 0 2px 8px rgba(0,0,0,0.06); } 25%, 75% { box-shadow: 0 0 0 4px #667eea, 0 8px 25px rgba(102,126,234,0.4); } }
        
        /* COMMUNITY SECTION */
        .community-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid #f3f4f6; }
        .community-toggle { background: #f8fafc; border: none; padding: 10px 16px; border-radius: 10px; width: 100%; display: flex; align-items: center; justify-content: space-between; cursor: pointer; font-size: 14px; color: #64748b; }
        .community-toggle:hover { background: #f1f5f9; }
        .community-toggle .count { background: #667eea; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; font-weight: 600; }
        .community-content { display: none; margin-top: 12px; }
        .community-content.show { display: block; animation: slideDown 0.3s ease; }
        
        /* TIPS */
        .tips-section { margin-bottom: 16px; }
        .tips-title { font-size: 13px; font-weight: 700; color: #374151; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .tip-card { background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 12px; border-radius: 10px; margin-bottom: 8px; }
        .tip-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .tip-avatar { width: 24px; height: 24px; border-radius: 50%; background: #f59e0b; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .tip-user { font-size: 12px; font-weight: 600; color: #92400e; }
        .tip-badge { background: #f59e0b; color: white; padding: 2px 6px; border-radius: 8px; font-size: 10px; font-weight: 600; }
        .tip-text { font-size: 13px; color: #78350f; line-height: 1.4; }
        .tip-helpful { display: flex; align-items: center; gap: 12px; margin-top: 8px; font-size: 12px; color: #92400e; }
        .tip-helpful button { background: none; border: none; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 4px; color: #92400e; }
        .tip-helpful button:hover { color: #78350f; }
        
        /* STAR RATING */
        .star-rating { display: flex; align-items: center; gap: 4px; margin: 8px 0; }
        .star { font-size: 20px; cursor: pointer; color: #e5e7eb; transition: color 0.2s; }
        .star.filled { color: #fbbf24; }
        .star:hover { transform: scale(1.2); }
        .rating-summary { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #6b7280; }
        .rating-avg { font-weight: 700; color: #f59e0b; }
        
        /* COMMENTS */
        .comments-section { margin-top: 12px; }
        .comments-title { font-size: 13px; font-weight: 700; color: #374151; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .comment-card { background: #f8fafc; padding: 12px; border-radius: 10px; margin-bottom: 8px; }
        .comment-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .comment-avatar { width: 28px; height: 28px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600; }
        .comment-user { font-size: 12px; font-weight: 600; color: #374151; }
        .comment-time { font-size: 11px; color: #9ca3af; }
        .comment-text { font-size: 13px; color: #4b5563; line-height: 1.4; }
        .comment-actions { display: flex; align-items: center; gap: 12px; margin-top: 8px; }
        .comment-actions button { background: none; border: none; cursor: pointer; font-size: 12px; color: #6b7280; display: flex; align-items: center; gap: 4px; }
        .comment-actions button:hover { color: #374151; }
        
        /* ADD COMMENT/TIP */
        .add-input-section { margin-top: 12px; }
        .add-input-row { display: flex; gap: 8px; }
        .add-input { flex: 1; border: 2px solid #e5e7eb; border-radius: 10px; padding: 10px 12px; font-size: 14px; outline: none; }
        .add-input:focus { border-color: #667eea; }
        .add-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 10px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; white-space: nowrap; }
        .add-btn:hover { transform: scale(1.05); }
        .input-tabs { display: flex; gap: 8px; margin-bottom: 8px; }
        .input-tab { background: #f1f5f9; border: none; padding: 8px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; }
        .input-tab.active { background: #667eea; color: white; }
        
        /* VERIFIED BADGE */
        .verified-badge { background: #10b981; color: white; padding: 2px 6px; border-radius: 8px; font-size: 10px; font-weight: 600; display: inline-flex; align-items: center; gap: 2px; }
        
        /* NO COMMENTS */
        .no-content { text-align: center; padding: 20px; color: #9ca3af; font-size: 13px; }
        
        /* ADD DEAL FLOATING BUTTON */
        .fab-add { position: fixed; bottom: 90px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; font-size: 28px; cursor: pointer; box-shadow: 0 4px 20px rgba(16,185,129,0.4); z-index: 90; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .fab-add:hover { transform: scale(1.1); box-shadow: 0 6px 30px rgba(16,185,129,0.5); }
        .fab-add:active { transform: scale(0.95); }
        .fab-tooltip { position: absolute; right: 70px; background: #1f2937; color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; white-space: nowrap; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .fab-add:hover .fab-tooltip { opacity: 1; }
        
        /* LINK SUBMIT MODAL */
        .link-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 600; display: none; align-items: center; justify-content: center; padding: 20px; }
        .link-modal.show { display: flex; animation: fadeIn 0.3s; }
        .link-modal-content { background: white; border-radius: 24px; padding: 24px; max-width: 400px; width: 100%; animation: slideUp 0.3s; }
        .link-modal-header { text-align: center; margin-bottom: 20px; }
        .link-modal-icon { font-size: 48px; margin-bottom: 12px; }
        .link-modal-title { font-size: 20px; font-weight: 800; color: #1f2937; }
        .link-modal-subtitle { font-size: 14px; color: #6b7280; margin-top: 4px; }
        
        .link-input-section { margin: 20px 0; }
        .link-input { width: 100%; border: 2px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; font-size: 15px; outline: none; transition: all 0.2s; }
        .link-input:focus { border-color: #10b981; box-shadow: 0 0 0 3px rgba(16,185,129,0.1); }
        .link-input::placeholder { color: #9ca3af; }
        .link-paste-btn { width: 100%; margin-top: 8px; background: #f1f5f9; border: 2px dashed #cbd5e1; border-radius: 12px; padding: 12px; color: #64748b; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .link-paste-btn:hover { background: #e2e8f0; border-color: #94a3b8; }
        
        .link-preview { margin: 20px 0; padding: 16px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 12px; display: none; }
        .link-preview.show { display: block; animation: slideDown 0.3s; }
        .link-preview-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .link-preview-logo { font-size: 32px; }
        .link-preview-brand { font-weight: 700; color: #166534; }
        .link-preview-title { font-size: 15px; color: #14532d; margin-bottom: 4px; }
        .link-preview-type { display: inline-block; background: #16a34a; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; }
        
        .link-reward-preview { background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; padding: 16px; margin: 16px 0; text-align: center; }
        .link-reward-amount { font-size: 32px; font-weight: 800; color: #92400e; }
        .link-reward-text { font-size: 13px; color: #a16207; }
        
        .link-submit-btn { width: 100%; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .link-submit-btn:hover { transform: scale(1.02); }
        .link-submit-btn:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
        
        .link-modal-close { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 28px; cursor: pointer; color: white; }
        
        /* SUCCESS ANIMATION */
        .success-animation { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(16,185,129,0.95); z-index: 700; display: none; align-items: center; justify-content: center; flex-direction: column; color: white; }
        .success-animation.show { display: flex; animation: fadeIn 0.3s; }
        .success-icon { font-size: 80px; animation: bounceIn 0.5s; }
        .success-title { font-size: 28px; font-weight: 800; margin-top: 20px; }
        .success-xp { font-size: 48px; font-weight: 800; margin-top: 12px; animation: pulse 1s infinite; }
        .success-subtitle { font-size: 16px; opacity: 0.9; margin-top: 8px; }
        .success-bonus { background: rgba(255,255,255,0.2); padding: 12px 24px; border-radius: 30px; margin-top: 20px; font-weight: 600; }
        @keyframes bounceIn { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        
        /* USER DEALS BADGE */
        .user-deal-badge { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: 600; margin-left: 8px; }
        
        /* LEADERBOARD TEASER */
        .leaderboard-teaser { background: linear-gradient(135deg, #8b5cf6, #6366f1); border-radius: 16px; padding: 16px; margin-bottom: 16px; color: white; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .leaderboard-teaser:hover { transform: scale(1.02); }
        .leaderboard-icon { font-size: 32px; }
        .leaderboard-info { flex: 1; }
        .leaderboard-title { font-weight: 700; }
        .leaderboard-text { font-size: 13px; opacity: 0.9; }
        .leaderboard-rank { background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-weight: 700; }
        .deal-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .deal-logo { font-size: 32px; }
        .deal-brand { font-weight: 600; color: #374151; font-size: 14px; }
        .deal-title { font-weight: 700; font-size: 17px; color: #111827; }
        .deal-desc { color: #6b7280; font-size: 14px; line-height: 1.5; margin: 10px 0; }
        .deal-meta { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-gratis { background: #dcfce7; color: #16a34a; }
        .badge-rabatt { background: #fef3c7; color: #d97706; }
        .badge-hot { background: #fef2f2; color: #ef4444; }
        .badge-new { background: #e0e7ff; color: #4f46e5; }
        .deal-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid #f3f4f6; }
        .deal-info { font-size: 12px; color: #9ca3af; }
        .deal-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 14px; text-decoration: none; display: inline-block; }
        .vote-section { display: flex; align-items: center; gap: 8px; margin-top: 10px; }
        .vote-btn { background: #f3f4f6; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 14px; }
        .vote-btn:hover { background: #e5e7eb; }
        .vote-count { font-weight: 600; min-width: 30px; text-align: center; }
        .share-btn { background: #25D366; color: white; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 14px; }
        .code-display { background: #faf5ff; border: 2px dashed #8b5cf6; border-radius: 8px; padding: 8px 12px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; }
        .code-text { font-family: monospace; font-weight: 700; color: #7c3aed; font-size: 14px; }
        .code-copy { background: #8b5cf6; color: white; border: none; border-radius: 6px; padding: 4px 10px; font-size: 12px; cursor: pointer; }
        .empty { text-align: center; padding: 60px 20px; color: #666; }
        .empty-icon { font-size: 48px; margin-bottom: 12px; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 24px; border-radius: 30px; font-weight: 600; z-index: 1000; animation: toastIn 0.3s ease; }
        @keyframes toastIn { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        
        /* BOTTOM NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 8px 16px; padding-bottom: max(8px, env(safe-area-inset-bottom)); display: flex; justify-content: space-around; box-shadow: 0 -2px 20px rgba(0,0,0,0.1); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 2px; padding: 8px 16px; border-radius: 12px; cursor: pointer; }
        .nav-item:hover, .nav-item.active { background: #f1f5f9; }
        .nav-item.active { color: #667eea; }
        .nav-icon { font-size: 20px; }
        .nav-label { font-size: 10px; font-weight: 600; }
        .nav-badge { position: absolute; top: -4px; right: -4px; background: #ef4444; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: 700; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÅ FreeFinder Wien</h1>
        <p class="subtitle">T√§glich neue Gratis-Deals & Rabatte</p>
        
        <div class="streak-banner" id="streakBanner">
            <div class="streak-fire">üî•</div>
            <div class="streak-info">
                <div class="streak-days" id="streakDays">1 Tag Streak!</div>
                <div class="streak-text">Komm morgen wieder f√ºr Bonus XP!</div>
            </div>
            <div class="streak-reward" id="streakReward">+10 XP</div>
        </div>
        
        <div class="daily-deal" id="dailyDeal">
            <div class="daily-label">‚≠ê DEAL DES TAGES</div>
            <div class="daily-title" id="dailyTitle">Wird geladen...</div>
            <div class="daily-desc" id="dailyDesc"></div>
            <div class="daily-countdown">
                <div class="countdown-box"><div class="countdown-num" id="countH">00</div><div class="countdown-label">Std</div></div>
                <div class="countdown-box"><div class="countdown-num" id="countM">00</div><div class="countdown-label">Min</div></div>
                <div class="countdown-box"><div class="countdown-num" id="countS">00</div><div class="countdown-label">Sek</div></div>
            </div>
            <button class="daily-btn" id="dailyBtn">Jetzt sichern ‚Üí</button>
        </div>
        
        <div class="savings-card" id="savingsCard">
            <div class="savings-header">
                <div class="savings-title">üí∞ Diese Woche gespart</div>
                <div class="savings-amount" id="savingsAmount">‚Ç¨0</div>
            </div>
            <div class="savings-bar"><div class="savings-progress" id="savingsBar" style="width: 0%"></div></div>
            <div class="savings-goal"><span>‚Ç¨0</span><span>Ziel: ‚Ç¨50</span></div>
        </div>
        
        <div class="search-box" id="searchBox">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" id="searchInput" placeholder="Suche z.B. Kaffee, IKEA..." autocomplete="off">
            <button class="clear-btn" id="clearBtn" onclick="clearSearch(event)">‚úï</button>
            <div class="search-dropdown" id="searchDropdown">
                <div class="search-section">
                    <div class="search-section-title">üî• Beliebte Suchen</div>
                    <div>
                        <span class="search-tag trending" onclick="searchFor('gratis kaffee')">‚òï Gratis Kaffee</span>
                        <span class="search-tag trending" onclick="searchFor('fitness')">üí™ Fitness</span>
                        <span class="search-tag" onclick="searchFor('mcdonalds')">üçü McDonald's</span>
                        <span class="search-tag" onclick="searchFor('ikea')">ü™ë IKEA</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="filters" id="filters">
            <div class="filter-row" id="typeFilters">
                <button class="filter-btn active" data-filter="alle">üéØ Alle <span class="filter-count" id="countAll">0</span></button>
                <button class="filter-btn" data-filter="gratis">üéÅ Gratis <span class="filter-count" id="countGratis">0</span></button>
                <button class="filter-btn" data-filter="rabatt">üí∞ Rabatt <span class="filter-count" id="countRabatt">0</span></button>
                <button class="filter-btn" data-filter="codes">üè∑Ô∏è Codes <span class="filter-count" id="countCodes">0</span></button>
            </div>
            <div class="filter-divider"></div>
            <div class="filter-row" id="categoryFilters">
                <button class="filter-btn active" data-category="alle">üéØ Alle</button>
                <button class="filter-btn" data-category="kaffee">‚òï Kaffee</button>
                <button class="filter-btn" data-category="essen">üçî Essen</button>
                <button class="filter-btn" data-category="fitness">üí™ Fitness</button>
                <button class="filter-btn" data-category="reisen">‚úàÔ∏è Reisen</button>
                <button class="filter-btn" data-category="supermarkt">üõí Supermarkt</button>
                <button class="filter-btn" data-category="beauty">üíá Beauty</button>
                <button class="filter-btn" data-category="technik">üì± Technik</button>
                <button class="filter-btn" data-category="streaming">üì∫ Streaming</button>
                <button class="filter-btn" data-category="wien">üèõÔ∏è Wien</button>
            </div>
        </div>
        
        <div id="deals"><div class="loading">üîÑ Lade Deals...</div></div>
    </div>
    
    <div class="modal-overlay" id="spinModal">
        <div class="modal">
            <button class="modal-close" onclick="closeSpinModal()">√ó</button>
            <h2>üé° T√§gliches Gl√ºcksrad</h2>
            <p style="color: #6b7280; font-size: 14px; margin-top: 8px;">Drehe einmal t√§glich!</p>
            <div class="wheel-container">
                <div class="wheel-pointer">üìç</div>
                <div class="wheel" id="wheel"></div>
                <div class="wheel-center">üéÅ</div>
            </div>
            <div class="spin-result" id="spinResult">
                <div class="spin-result-text" id="spinResultText"></div>
            </div>
            <button class="modal-btn" id="spinBtn" onclick="spinWheel()">üé∞ Drehen!</button>
        </div>
    </div>
    
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showHome()"><div class="nav-icon">üè†</div><div class="nav-label">Deals</div></div>
        <div class="nav-item" onclick="showSecretDeals()"><div class="nav-icon">üîÆ</div><div class="nav-label">Geheim</div></div>
        <div class="nav-item" onclick="showStats()"><div class="nav-icon">üìä</div><div class="nav-label">Stats</div></div>
        <div class="nav-item" onclick="showFavorites()" style="position:relative;"><div class="nav-icon">‚ù§Ô∏è</div><div class="nav-label">Favoriten</div><span class="nav-badge" id="favBadge" style="display:none;">0</span></div>
    </div>
    
    <!-- FAB ADD DEAL BUTTON -->
    <button class="fab-add" onclick="openLinkModal()">
        +
        <span class="fab-tooltip">üîó Deal-Link einf√ºgen</span>
    </button>
    
    <!-- LINK SUBMIT MODAL -->
    <div class="link-modal" id="linkModal">
        <button class="link-modal-close" onclick="closeLinkModal()">√ó</button>
        <div class="link-modal-content">
            <div class="link-modal-header">
                <div class="link-modal-icon">üîó</div>
                <div class="link-modal-title">Deal-Link teilen</div>
                <div class="link-modal-subtitle">Hast du einen Gratis-Deal entdeckt? Teile ihn mit der Community!</div>
            </div>
            
            <div class="link-input-section">
                <input type="url" class="link-input" id="linkInput" placeholder="https://beispiel.at/gratis-angebot..." oninput="previewLink()">
                <button class="link-paste-btn" onclick="pasteFromClipboard()">
                    üìã Aus Zwischenablage einf√ºgen
                </button>
            </div>
            
            <div class="link-preview" id="linkPreview">
                <div class="link-preview-header">
                    <span class="link-preview-logo" id="previewLogo">üéÅ</span>
                    <span class="link-preview-brand" id="previewBrand">Wird erkannt...</span>
                </div>
                <div class="link-preview-title" id="previewTitle">Deal wird analysiert...</div>
                <span class="link-preview-type" id="previewType">GRATIS</span>
            </div>
            
            <div class="link-reward-preview">
                <div class="link-reward-amount">+100 XP</div>
                <div class="link-reward-text">üéÅ Belohnung f√ºr deinen Beitrag zur Community!</div>
            </div>
            
            <button class="link-submit-btn" id="linkSubmitBtn" onclick="submitDealLink()" disabled>
                üöÄ Deal einreichen
            </button>
        </div>
    </div>
    
    <!-- SUCCESS ANIMATION -->
    <div class="success-animation" id="successAnimation">
        <div class="success-icon">üéâ</div>
        <div class="success-title">DEAL EINGEREICHT!</div>
        <div class="success-xp">+100 XP</div>
        <div class="success-subtitle">Danke f√ºr deinen Beitrag!</div>
        <div class="success-bonus">üèÜ Du bist jetzt Deal-Hunter Rang #<span id="userRank">42</span></div>
    </div>

    <script>
        let allDeals = [];
        let currentFilter = 'alle';
        let currentCategory = 'alle';
        let searchQuery = '';
        let votes = JSON.parse(localStorage.getItem('votes') || '{}');
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        let comments = JSON.parse(localStorage.getItem('comments') || '{}');
        let userTips = JSON.parse(localStorage.getItem('userTips') || '{}');
        let ratings = JSON.parse(localStorage.getItem('ratings') || '{}');
        let userRatings = JSON.parse(localStorage.getItem('userRatings') || '{}');
        let userDeals = JSON.parse(localStorage.getItem('userDeals') || '[]');
        let submittedLinks = JSON.parse(localStorage.getItem('submittedLinks') || '[]');
        
        // Bekannte Marken f√ºr Link-Erkennung
        const KNOWN_BRANDS = {
            'mcdonalds': { name: "McDonald's", logo: 'üçü', category: 'essen' },
            'burgerking': { name: 'Burger King', logo: 'üçî', category: 'essen' },
            'ikea': { name: 'IKEA', logo: 'ü™ë', category: 'shopping' },
            'billa': { name: 'BILLA', logo: 'üõí', category: 'supermarkt' },
            'spar': { name: 'SPAR', logo: 'üõí', category: 'supermarkt' },
            'hofer': { name: 'HOFER', logo: 'üõí', category: 'supermarkt' },
            'lidl': { name: 'Lidl', logo: 'üõí', category: 'supermarkt' },
            'dm': { name: 'dm', logo: 'üíá', category: 'beauty' },
            'm√ºller': { name: 'M√ºller', logo: 'üíÑ', category: 'beauty' },
            'mediamarkt': { name: 'MediaMarkt', logo: 'üì∫', category: 'technik' },
            'saturn': { name: 'Saturn', logo: 'üì∫', category: 'technik' },
            'amazon': { name: 'Amazon', logo: 'üì¶', category: 'shopping' },
            'zalando': { name: 'Zalando', logo: 'üëü', category: 'mode' },
            'aboutyou': { name: 'ABOUT YOU', logo: 'üëó', category: 'mode' },
            'hm': { name: 'H&M', logo: 'üëï', category: 'mode' },
            'starbucks': { name: 'Starbucks', logo: '‚òï', category: 'kaffee' },
            'tchibo': { name: 'Tchibo', logo: '‚òï', category: 'kaffee' },
            'nespresso': { name: 'Nespresso', logo: '‚òï', category: 'kaffee' },
            'netflix': { name: 'Netflix', logo: 'üì∫', category: 'streaming' },
            'spotify': { name: 'Spotify', logo: 'üéµ', category: 'streaming' },
            'fitinn': { name: 'FitInn', logo: 'üí™', category: 'fitness' },
            'mcfit': { name: 'McFIT', logo: 'üí™', category: 'fitness' },
            'ryanair': { name: 'Ryanair', logo: '‚úàÔ∏è', category: 'reisen' },
            'wizz': { name: 'Wizz Air', logo: '‚úàÔ∏è', category: 'reisen' },
            'oebb': { name: '√ñBB', logo: 'üöÇ', category: 'reisen' },
            'mjam': { name: 'Mjam', logo: 'üõµ', category: 'essen' },
            'lieferando': { name: 'Lieferando', logo: 'üõµ', category: 'essen' },
            'uber': { name: 'Uber Eats', logo: 'üçî', category: 'essen' },
            'kfc': { name: 'KFC', logo: 'üçó', category: 'essen' },
            'subway': { name: 'Subway', logo: 'ü•™', category: 'essen' },
            'dominos': { name: "Domino's", logo: 'üçï', category: 'essen' },
            'nordsee': { name: 'NORDSEE', logo: 'üêü', category: 'essen' },
            'vapiano': { name: 'Vapiano', logo: 'üçù', category: 'essen' },
            'dougla': { name: 'Douglas', logo: 'üíã', category: 'beauty' },
            'sephora': { name: 'Sephora', logo: 'üíÑ', category: 'beauty' },
            'apple': { name: 'Apple', logo: 'üçé', category: 'technik' },
            'samsung': { name: 'Samsung', logo: 'üì±', category: 'technik' },
            'a1': { name: 'A1', logo: 'üì∂', category: 'technik' },
            'magenta': { name: 'Magenta', logo: 'üì±', category: 'technik' },
            'drei': { name: 'Drei', logo: 'üì±', category: 'technik' },
            'booking': { name: 'Booking.com', logo: 'üè®', category: 'reisen' },
            'airbnb': { name: 'Airbnb', logo: 'üè†', category: 'reisen' },
        };
        
        // Vordefinierte Community-Tipps
        const defaultTips = {
            'top-1': [
                { id: 't1', user: 'SparFuchs22', text: '‚òùÔ∏è Zuerst j√∂ App √∂ffnen, dann an der Kassa den Barcode scannen lassen BEVOR du bezahlst!', avatar: 'ü¶ä', verified: true, badge: 'Top Tipp', helpful: 47 },
                { id: 't2', user: 'WienDeals', text: 'Funktioniert bei allen OMV VIVA Tankstellen in Wien. Am besten morgens, da ist die Auswahl gr√∂√üer!', avatar: 'üéØ', helpful: 23 }
            ],
            'top-2': [
                { id: 't3', user: 'IKEAFan', text: 'üí° IKEA Family Karte in der App vorzeigen. Gilt f√ºr Filterkaffee UND Tee - unbegrenzt nachf√ºllen!', avatar: '‚òï', verified: true, badge: 'Experte', helpful: 89 },
                { id: 't4', user: 'KaffeeLiebe', text: 'Im Restaurant UND im Bistro einl√∂sbar. Tipp: Nach 15 Uhr ist weniger los!', avatar: 'üòä', helpful: 34 }
            ],
            'top-3': [
                { id: 't5', user: 'FoodieWien', text: 'üçõ Einfach hingehen, Buffet nehmen, und am Ende zahlen was du willst. Minimum gibt es nicht!', avatar: 'üçΩÔ∏è', verified: true, helpful: 56 },
                { id: 't6', user: 'StudentLife', text: 'Perfekt f√ºr Studenten! Ich zahle meist 5-7‚Ç¨ und werde super satt. Sehr leckeres Curry!', avatar: 'üìö', helpful: 41 }
            ],
            'top-4': [
                { id: 't7', user: 'McFreak', text: 'üì± In der McDonalds App auf "Feedback" gehen, Kassenbon-Code eingeben, Gratis-Kaffee in 2 Min!', avatar: 'üçü', verified: true, badge: 'Pro Tipp', helpful: 112 },
                { id: 't8', user: 'KaffeeJunkie', text: 'Geht 5x pro Monat! Ich nutze es jeden Montag f√ºr den Wochenstart ‚òï', avatar: '‚òï', helpful: 67 }
            ],
            'fitness-1': [
                { id: 't9', user: 'FitGirl23', text: 'üí™ Online Termin buchen, Ausweis mitbringen. Handtuch wird gestellt!', avatar: 'üèãÔ∏è', verified: true, helpful: 38 },
                { id: 't10', user: 'GymBro', text: 'Tipp: Gleich fragen ob sie aktuell Aktionen haben - oft gibt es Rabatt wenn man direkt abschlie√üt', avatar: 'üí™', helpful: 29 }
            ],
            'reisen-1': [
                { id: 't11', user: 'TravelHacker', text: '‚úàÔ∏è Newsletter abonnieren f√ºr Flash Sales! Die besten Deals kommen Dienstag & Donnerstag', avatar: 'üåç', verified: true, badge: 'Reise-Experte', helpful: 94 },
                { id: 't12', user: 'BudgetTravel', text: 'Flexibel beim Datum sein und "g√ºnstigster Monat" w√§hlen. Wien-Barcelona f√ºr 9,99‚Ç¨ gebucht!', avatar: '‚úàÔ∏è', helpful: 78 }
            ],
            'event-1': [
                { id: 't13', user: 'WienKultur', text: 'üé¨ Fr√ºh kommen (ab 18 Uhr) f√ºr gute Pl√§tze! Decke und Snacks mitnehmen. Eintritt komplett GRATIS!', avatar: 'üé≠', verified: true, helpful: 156 }
            ],
            'event-2': [
                { id: 't14', user: 'FestivalFan', text: 'üé∏ U-Bahn Linie U1 bis Donauinsel. Alle 3 B√ºhnen gratis! Getr√§nke vor Ort kaufen oder eigene mitnehmen.', avatar: 'üéµ', verified: true, badge: 'Festival-Pro', helpful: 203 }
            ]
        };
        
        let userData = JSON.parse(localStorage.getItem('userData') || JSON.stringify({
            xp: 0, level: 1, streak: 0, lastVisit: null, dealsViewed: 0, todayViewed: 0,
            todayDate: null, totalSavings: 0, spinUsedToday: false, spinDate: null,
            challengeComplete: false, secretUnlocked: false
        }));
        
        const LEVELS = [
            { name: 'üå± Schn√§ppchen-Anf√§nger', xp: 0 },
            { name: 'üåø Deal-Entdecker', xp: 100 },
            { name: 'üå≥ Spar-Experte', xp: 300 },
            { name: '‚≠ê Gratis-J√§ger', xp: 600 },
            { name: 'üèÜ Deal-Meister', xp: 1000 },
            { name: 'üëë Schn√§ppchen-K√∂nig', xp: 1500 },
            { name: 'üíé Legend√§rer Sparer', xp: 2500 }
        ];
        
        const SPIN_PRIZES = [
            { text: '+10 XP', xp: 10 }, { text: '+25 XP', xp: 25 }, { text: '+50 XP', xp: 50 },
            { text: '2x Streak!', special: 'streak' }, { text: '+100 XP!', xp: 100 },
            { text: 'Secret Deal!', special: 'secret' }, { text: '+15 XP', xp: 15 }, { text: '+30 XP', xp: 30 }
        ];
        
        function init() {
            checkStreak();
            updateLevelUI();
            updateSavingsUI();
            checkChallenge();
            checkSpin();
            startCountdowns();
            loadDeals();
            updateFavBadge();
        }
        
        function checkStreak() {
            const today = new Date().toDateString();
            if (userData.lastVisit !== today) {
                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                if (userData.lastVisit === yesterday.toDateString()) {
                    userData.streak++;
                    addXP(Math.min(10 + userData.streak * 5, 50), 'üî• Streak Tag ' + userData.streak + '!');
                } else if (userData.lastVisit) {
                    userData.streak = 1;
                    addXP(10, 'üëã Willkommen zur√ºck!');
                } else {
                    userData.streak = 1;
                    addXP(10, 'üéâ Erster Besuch!');
                }
                userData.lastVisit = today;
                userData.todayViewed = 0;
                userData.todayDate = today;
                userData.challengeComplete = false;
                saveUserData();
            }
            document.getElementById('streakDays').textContent = userData.streak + ' Tag' + (userData.streak > 1 ? 'e' : '') + ' Streak!';
            document.getElementById('streakReward').textContent = '+' + Math.min(10 + userData.streak * 5, 50) + ' XP';
        }
        
        function addXP(amount, reason) {
            userData.xp += amount;
            for (let i = LEVELS.length - 1; i >= 0; i--) {
                if (userData.xp >= LEVELS[i].xp && userData.level < i + 1) {
                    userData.level = i + 1;
                    showToast('üéâ Level Up! ' + LEVELS[i].name);
                    break;
                }
            }
            saveUserData();
            updateLevelUI();
            showXPPopup('+' + amount + ' XP');
            if (reason) showToast(reason);
        }
        
        function updateLevelUI() {
            const level = LEVELS[userData.level - 1] || LEVELS[0];
            const nextLevel = LEVELS[userData.level] || level;
            const progress = Math.min(((userData.xp - level.xp) / (nextLevel.xp - level.xp)) * 100, 100);
            const lb = document.getElementById('levelBadge');
            const ln = document.getElementById('levelName');
            const lf = document.getElementById('levelXpFill');
            const lt = document.getElementById('levelXpText');
            if (lb) lb.textContent = userData.level;
            if (ln) ln.textContent = level.name;
            if (lf) lf.style.width = progress + '%';
            if (lt) lt.textContent = userData.xp + ' / ' + nextLevel.xp + ' XP';
        }
        
        function showXPPopup(text) {
            const popup = document.createElement('div');
            popup.className = 'xp-popup';
            popup.textContent = text;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }
        
        function updateSavingsUI() {
            document.getElementById('savingsAmount').textContent = '‚Ç¨' + userData.totalSavings;
            document.getElementById('savingsBar').style.width = Math.min((userData.totalSavings / 50) * 100, 100) + '%';
        }
        
        function trackDealView() {
            const today = new Date().toDateString();
            if (userData.todayDate !== today) { userData.todayViewed = 0; userData.todayDate = today; userData.challengeComplete = false; }
            userData.todayViewed++;
            userData.dealsViewed++;
            saveUserData();
            updateChallengeUI();
            if (userData.todayViewed >= 5 && !userData.challengeComplete) {
                userData.challengeComplete = true;
                userData.secretUnlocked = true;
                saveUserData();
                addXP(25, 'üéØ Challenge geschafft!');
                unlockSecret();
            }
        }
        
        function checkChallenge() { updateChallengeUI(); }
        
        function updateChallengeUI() {
            const dots = document.querySelectorAll('.challenge-dot');
            const viewed = Math.min(userData.todayViewed, 5);
            dots.forEach((dot, i) => {
                dot.classList.remove('done', 'current');
                if (i < viewed) { dot.classList.add('done'); dot.textContent = '‚úì'; }
                else if (i === viewed) { dot.classList.add('current'); dot.textContent = i + 1; }
                else { dot.textContent = i + 1; }
            });
            const sf = document.getElementById('secretFill');
            const st = document.getElementById('secretText');
            if (sf) sf.style.width = (viewed / 5) * 100 + '%';
            if (st) st.textContent = viewed + '/5 Deals angesehen';
            if (userData.secretUnlocked) unlockSecret();
        }
        
        function unlockSecret() {
            const sd = document.getElementById('secretDeal');
            if (!sd) return;
            sd.classList.remove('locked');
            sd.classList.add('secret-unlocked');
            sd.innerHTML = '<div class="secret-header"><div class="secret-icon">üéÅ</div><div><div class="secret-title">GEHEIMER DEAL!</div><div class="secret-desc">McDonald\'s: Gratis McFlurry!</div></div></div><button class="daily-btn" style="margin-top:12px;width:100%" onclick="window.open(\'https://www.mcdonalds.at/app\')">Einl√∂sen ‚Üí</button>';
        }
        
        function checkSpin() {
            const today = new Date().toDateString();
            if (userData.spinDate !== today) { userData.spinUsedToday = false; userData.spinDate = today; saveUserData(); }
            if (userData.spinUsedToday) {
                const sbs = document.getElementById('spinBtnSmall');
                const sb = document.getElementById('spinBtn');
                if (sbs) { sbs.textContent = '‚úì Gedreht'; sbs.classList.add('spin-used'); }
                if (sb) { sb.disabled = true; sb.textContent = 'Morgen wieder!'; }
            }
        }
        
        function openSpinModal() { document.getElementById('spinModal').classList.add('show'); }
        function closeSpinModal() { document.getElementById('spinModal').classList.remove('show'); }
        
        function spinWheel() {
            if (userData.spinUsedToday) return;
            const wheel = document.getElementById('wheel');
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            const prizeIndex = Math.floor(Math.random() * SPIN_PRIZES.length);
            const prize = SPIN_PRIZES[prizeIndex];
            wheel.style.transform = 'rotate(' + (1800 + prizeIndex * 45 + Math.random() * 40) + 'deg)';
            setTimeout(() => {
                document.getElementById('spinResult').classList.add('show');
                document.getElementById('spinResultText').textContent = 'üéâ ' + prize.text;
                if (prize.xp) addXP(prize.xp, 'üé° ' + prize.text);
                else if (prize.special === 'secret') { userData.secretUnlocked = true; saveUserData(); unlockSecret(); showToast('üéÅ Secret Deal!'); }
                else if (prize.special === 'streak') addXP(userData.streak * 10, 'üî• 2x Streak!');
                userData.spinUsedToday = true; saveUserData();
                btn.textContent = 'Morgen wieder!';
                document.getElementById('spinBtnSmall').textContent = '‚úì Gedreht';
                document.getElementById('spinBtnSmall').classList.add('spin-used');
            }, 4000);
        }
        
        function startCountdowns() {
            setInterval(() => {
                const now = new Date(), midnight = new Date(now); midnight.setHours(24, 0, 0, 0);
                const diff = midnight - now;
                const ch = document.getElementById('countH');
                const cm = document.getElementById('countM');
                const cs = document.getElementById('countS');
                if (ch) ch.textContent = String(Math.floor(diff / 3600000)).padStart(2, '0');
                if (cm) cm.textContent = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
                if (cs) cs.textContent = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
            }, 1000);
            let um = 29, us = 59;
            setInterval(() => {
                us--; if (us < 0) { us = 59; um--; }
                if (um < 0) { um = 29; showToast('üîÑ Aktualisiert!'); loadDeals(); }
                const uc = document.getElementById('updateCountdown');
                if (uc) uc.textContent = um + ':' + String(us).padStart(2, '0');
            }, 1000);
        }
        
        async function loadDeals() {
            try {
                const res = await fetch('deals.json?t=' + Date.now());
                const data = await res.json();
                // Kombiniere User-Deals mit Base-Deals (User-Deals zuerst)
                const baseDeals = data.deals.map(d => ({ ...d, votes: votes[d.id] || d.votes || 0 }));
                const userDealsWithVotes = userDeals.map(d => ({ ...d, votes: votes[d.id] || d.votes || 0 }));
                allDeals = [...userDealsWithVotes, ...baseDeals];
                updateCounts(); renderDeals(); setDailyDeal();
            } catch (e) { document.getElementById('deals').innerHTML = '<div class="empty"><div class="empty-icon">üòï</div><p>Fehler</p></div>'; }
        }
        
        function setDailyDeal() {
            const deal = allDeals.filter(d => d.type === 'gratis')[new Date().getDate() % allDeals.filter(d => d.type === 'gratis').length] || allDeals[0];
            document.getElementById('dailyTitle').textContent = deal.logo + ' ' + deal.brand + ': ' + deal.title;
            document.getElementById('dailyDesc').textContent = deal.description;
            document.getElementById('dailyBtn').onclick = () => { window.open(deal.url, '_blank'); userData.totalSavings += 5; saveUserData(); updateSavingsUI(); trackDealView(); };
        }
        
        function updateCounts() {
            document.getElementById('countAll').textContent = allDeals.length;
            document.getElementById('countGratis').textContent = allDeals.filter(d => d.type === 'gratis').length;
            document.getElementById('countRabatt').textContent = allDeals.filter(d => d.type === 'rabatt' || d.type === 'testabo').length;
            document.getElementById('countCodes').textContent = allDeals.filter(d => d.category === 'codes' || d.code).length;
        }
        
        function filterDeals() {
            let deals = [...allDeals];
            if (searchQuery) { const q = searchQuery.toLowerCase(); deals = deals.filter(d => d.title.toLowerCase().includes(q) || d.brand.toLowerCase().includes(q) || d.description.toLowerCase().includes(q)); }
            if (currentFilter !== 'alle') {
                if (currentFilter === 'codes') deals = deals.filter(d => d.category === 'codes' || d.code);
                else if (currentFilter === 'rabatt') deals = deals.filter(d => d.type === 'rabatt' || d.type === 'testabo');
                else deals = deals.filter(d => d.type === currentFilter);
            }
            if (currentCategory !== 'alle') deals = deals.filter(d => d.category === currentCategory);
            return deals;
        }
        
        function renderDeals() {
            const deals = filterDeals();
            if (deals.length === 0) { document.getElementById('deals').innerHTML = '<div class="empty"><div class="empty-icon">üîç</div><p>Keine Deals</p></div>'; return; }
            document.getElementById('deals').innerHTML = deals.map(d => {
                const dealComments = comments[d.id] || [];
                const dealTips = [...(defaultTips[d.id] || []), ...(userTips[d.id] || [])];
                const dealRating = ratings[d.id] || { total: 0, count: 0 };
                const avgRating = dealRating.count > 0 ? (dealRating.total / dealRating.count).toFixed(1) : '0';
                const totalCommunity = dealComments.length + dealTips.length;
                
                return '<div class="deal-card ' + (d.hot ? 'hot' : '') + '" id="deal-' + d.id + '"><div class="deal-header" onclick="trackDealView()"><span class="deal-logo">' + d.logo + '</span><div><div class="deal-brand">' + d.brand + '</div><div class="deal-title">' + d.title + '</div></div></div><div class="deal-desc">' + d.description + '</div>' + 
                (d.code ? '<div class="code-display"><span class="code-text">' + d.code + '</span><button class="code-copy" onclick="copyCode(\'' + d.code + '\',event)">Kopieren</button></div>' : '') + 
                '<div class="deal-meta"><span class="badge badge-' + d.type + '">' + (d.type === 'gratis' ? 'üéÅ GRATIS' : d.type === 'testabo' ? 'üÜì Testabo' : 'üí∞ Rabatt') + '</span>' + (d.hot ? '<span class="badge badge-hot">üî• Hot</span>' : '') + (d.isNew ? '<span class="badge badge-new">‚ú® Neu</span>' : '') + (d.isUserSubmitted ? '<span class="user-deal-badge">üë§ Community</span>' : '') + '</div>' +
                '<div class="star-rating" data-id="' + d.id + '">' + renderStars(d.id) + '<span class="rating-summary"><span class="rating-avg">' + avgRating + '</span> (' + dealRating.count + ' Bewertungen)</span></div>' +
                '<div class="deal-footer"><div class="deal-info">üìç ' + d.distance + ' ‚Ä¢ ‚è∞ ' + d.expires + '</div><a href="' + d.url + '" target="_blank" class="deal-btn" onclick="onDealClick(event)">Zum Deal ‚Üí</a></div>' +
                '<div class="vote-section"><button class="vote-btn" onclick="vote(\'' + d.id + '\',1,event)">üëç</button><span class="vote-count">' + d.votes + '</span><button class="vote-btn" onclick="vote(\'' + d.id + '\',-1,event)">üëé</button><button class="share-btn" onclick="shareDeal(\'' + d.id + '\',event)">üì§</button><button class="vote-btn" onclick="toggleFav(\'' + d.id + '\',event)" style="margin-left:auto">' + (favorites.includes(d.id) ? '‚ù§Ô∏è' : 'ü§ç') + '</button></div>' +
                '<div class="community-section"><button class="community-toggle" onclick="toggleCommunity(\'' + d.id + '\')"><span>üí¨ Community & Tipps</span><span class="count">' + totalCommunity + '</span></button>' +
                '<div class="community-content" id="community-' + d.id + '">' + renderCommunityContent(d.id, dealTips, dealComments) + '</div></div></div>';
            }).join('');
            checkDeepLink();
        }
        
        function renderStars(dealId) {
            const userRating = userRatings[dealId] || 0;
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += '<span class="star ' + (i <= userRating ? 'filled' : '') + '" onclick="rateDeal(\'' + dealId + '\',' + i + ',event)">‚òÖ</span>';
            }
            return stars;
        }
        
        function renderCommunityContent(dealId, tips, comments) {
            let html = '<div class="tips-section"><div class="tips-title">üí° Einl√∂sungs-Tipps</div>';
            if (tips.length > 0) {
                tips.forEach(tip => {
                    html += '<div class="tip-card"><div class="tip-header"><div class="tip-avatar">' + (tip.avatar || 'üë§') + '</div><span class="tip-user">' + tip.user + '</span>' + (tip.verified ? '<span class="verified-badge">‚úì Verifiziert</span>' : '') + (tip.badge ? '<span class="tip-badge">' + tip.badge + '</span>' : '') + '</div><div class="tip-text">' + tip.text + '</div><div class="tip-helpful"><button onclick="markHelpful(\'' + dealId + '\',\'' + tip.id + '\',event)">üëç Hilfreich (' + (tip.helpful || 0) + ')</button></div></div>';
                });
            } else {
                html += '<div class="no-content">Noch keine Tipps. Teile deinen ersten!</div>';
            }
            html += '</div>';
            
            html += '<div class="comments-section"><div class="comments-title">üí¨ Kommentare (' + comments.length + ')</div>';
            if (comments.length > 0) {
                comments.slice(-5).forEach(c => {
                    html += '<div class="comment-card"><div class="comment-header"><div class="comment-avatar">' + (c.user ? c.user[0].toUpperCase() : 'A') + '</div><span class="comment-user">' + c.user + '</span><span class="comment-time">' + timeAgo(c.time) + '</span></div><div class="comment-text">' + c.text + '</div><div class="comment-actions"><button onclick="likeComment(\'' + dealId + '\',\'' + c.id + '\',event)">üëç ' + (c.likes || 0) + '</button></div></div>';
                });
            } else {
                html += '<div class="no-content">Noch keine Kommentare. Sei der Erste!</div>';
            }
            html += '</div>';
            
            html += '<div class="add-input-section"><div class="input-tabs"><button class="input-tab active" onclick="switchInputTab(\'' + dealId + '\',\'comment\',this)">üí¨ Kommentar</button><button class="input-tab" onclick="switchInputTab(\'' + dealId + '\',\'tip\',this)">üí° Tipp</button></div><div class="add-input-row"><input type="text" class="add-input" id="input-' + dealId + '" placeholder="Schreibe einen Kommentar..." data-type="comment"><button class="add-btn" onclick="submitInput(\'' + dealId + '\')">Senden</button></div></div>';
            
            return html;
        }
        
        function toggleCommunity(dealId) {
            const content = document.getElementById('community-' + dealId);
            content.classList.toggle('show');
        }
        
        function switchInputTab(dealId, type, btn) {
            const input = document.getElementById('input-' + dealId);
            input.dataset.type = type;
            input.placeholder = type === 'tip' ? 'Teile einen Einl√∂sungs-Tipp...' : 'Schreibe einen Kommentar...';
            btn.parentElement.querySelectorAll('.input-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
        }
        
        function submitInput(dealId) {
            const input = document.getElementById('input-' + dealId);
            const text = input.value.trim();
            if (!text) return;
            
            const type = input.dataset.type || 'comment';
            const userName = 'Du';
            const id = Date.now().toString();
            
            if (type === 'tip') {
                if (!userTips[dealId]) userTips[dealId] = [];
                userTips[dealId].push({ id, user: userName, text, avatar: 'üòä', helpful: 0 });
                localStorage.setItem('userTips', JSON.stringify(userTips));
                addXP(10, 'üí° Tipp geteilt!');
            } else {
                if (!comments[dealId]) comments[dealId] = [];
                comments[dealId].push({ id, user: userName, text, time: Date.now(), likes: 0 });
                localStorage.setItem('comments', JSON.stringify(comments));
                addXP(5, 'üí¨ Kommentar gepostet!');
            }
            
            input.value = '';
            renderDeals();
            document.getElementById('community-' + dealId).classList.add('show');
        }
        
        function rateDeal(dealId, stars, e) {
            e.stopPropagation();
            userRatings[dealId] = stars;
            if (!ratings[dealId]) ratings[dealId] = { total: 0, count: 0 };
            ratings[dealId].total += stars;
            ratings[dealId].count += 1;
            localStorage.setItem('userRatings', JSON.stringify(userRatings));
            localStorage.setItem('ratings', JSON.stringify(ratings));
            addXP(3, '‚≠ê Bewertung abgegeben!');
            renderDeals();
        }
        
        function markHelpful(dealId, tipId, e) {
            e.stopPropagation();
            const tips = [...(defaultTips[dealId] || []), ...(userTips[dealId] || [])];
            const tip = tips.find(t => t.id === tipId);
            if (tip) { tip.helpful = (tip.helpful || 0) + 1; }
            localStorage.setItem('userTips', JSON.stringify(userTips));
            showToast('üëç Als hilfreich markiert!');
            renderDeals();
            document.getElementById('community-' + dealId).classList.add('show');
        }
        
        function likeComment(dealId, commentId, e) {
            e.stopPropagation();
            const comment = comments[dealId]?.find(c => c.id === commentId);
            if (comment) { comment.likes = (comment.likes || 0) + 1; }
            localStorage.setItem('comments', JSON.stringify(comments));
            renderDeals();
            document.getElementById('community-' + dealId).classList.add('show');
        }
        
        function timeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'gerade eben';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' Min';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' Std';
            return Math.floor(seconds / 86400) + ' Tage';
        }
        
        function onDealClick(e) { e.stopPropagation(); userData.totalSavings += Math.floor(Math.random() * 5) + 1; saveUserData(); updateSavingsUI(); addXP(2, null); }
        function vote(id, delta, e) { e.stopPropagation(); votes[id] = (votes[id] || 0) + delta; localStorage.setItem('votes', JSON.stringify(votes)); const deal = allDeals.find(d => d.id === id); if (deal) deal.votes = votes[id]; renderDeals(); addXP(1, null); showToast(delta > 0 ? 'üëç Danke!' : 'üëé Notiert!'); }
        function copyCode(code, e) { e.stopPropagation(); navigator.clipboard.writeText(code); addXP(3, null); showToast('üìã Code kopiert!'); }
        function shareDeal(id, e) { 
            e.stopPropagation(); 
            const deal = allDeals.find(d => d.id === id);
            if (!deal) return;
            const appUrl = 'https://ataalla24-ux.github.io/deal-finder/?deal=' + id; 
            const text = 'üéÅ ' + deal.brand + ': ' + deal.title + '\n\n' + deal.description + '\n\nüì± Direkt in der App √∂ffnen:\n' + appUrl; 
            if (navigator.share) navigator.share({ title: 'FreeFinder Deal', text: text }); 
            else window.open('https://wa.me/?text=' + encodeURIComponent(text), '_blank'); 
            addXP(5, 'üì§ Geteilt!'); 
        }
        function checkDeepLink() {
            const params = new URLSearchParams(window.location.search);
            const dealId = params.get('deal');
            if (dealId && !window.deepLinkHandled) {
                window.deepLinkHandled = true;
                setTimeout(() => {
                    const dealEl = document.getElementById('deal-' + dealId);
                    if (dealEl) {
                        dealEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        dealEl.style.animation = 'highlightDeal 2s ease';
                        showToast('üéØ Deal gefunden!');
                    }
                }, 500);
            }
        }
        function toggleFav(id, e) { e.stopPropagation(); if (favorites.includes(id)) { favorites = favorites.filter(f => f !== id); showToast('üíî Entfernt'); } else { favorites.push(id); showToast('‚ù§Ô∏è Favorit!'); addXP(2, null); } localStorage.setItem('favorites', JSON.stringify(favorites)); updateFavBadge(); renderDeals(); }
        function updateFavBadge() { const b = document.getElementById('favBadge'); if (favorites.length > 0) { b.style.display = 'block'; b.textContent = favorites.length; } else { b.style.display = 'none'; } }
        function showFavorites() { hideHeaderElements(); const fav = allDeals.filter(d => favorites.includes(d.id)); document.getElementById('deals').innerHTML = fav.length ? fav.map(d => '<div class="deal-card"><div class="deal-header"><span class="deal-logo">' + d.logo + '</span><div><div class="deal-brand">' + d.brand + '</div><div class="deal-title">' + d.title + '</div></div></div><a href="' + d.url + '" target="_blank" class="deal-btn" style="width:100%;text-align:center;margin-top:10px">Zum Deal ‚Üí</a></div>').join('') : '<div class="empty"><div class="empty-icon">‚ù§Ô∏è</div><p>Keine Favoriten</p><p style="font-size:13px;color:#999;margin-top:8px">Tippe ‚ù§Ô∏è bei einem Deal</p></div>'; document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.querySelectorAll('.nav-item')[3].classList.add('active'); }
        function showStats() { hideHeaderElements(); const level = LEVELS[userData.level - 1]; const nextLevel = LEVELS[userData.level] || LEVELS[LEVELS.length - 1]; const xpProgress = Math.min(100, ((userData.xp - (LEVELS[userData.level - 1]?.xp || 0)) / (nextLevel.xp - (LEVELS[userData.level - 1]?.xp || 0))) * 100); document.getElementById('deals').innerHTML = '<div style="padding:4px 0"><div style="text-align:center;margin-bottom:16px"><div style="font-size:32px">üìä</div><h2 style="font-size:22px;margin:8px 0 4px">Deine Stats</h2></div><div style="background:linear-gradient(135deg,#8b5cf6,#6366f1);border-radius:16px;padding:20px;color:white;margin-bottom:16px"><div style="display:flex;align-items:center;gap:16px"><div style="background:rgba(255,255,255,0.2);width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:800">' + userData.level + '</div><div style="flex:1"><div style="font-size:11px;opacity:0.8">LEVEL</div><div style="font-size:20px;font-weight:700">' + level.name + '</div><div style="background:rgba(255,255,255,0.3);height:8px;border-radius:4px;margin:10px 0 6px;overflow:hidden"><div style="background:white;height:100%;width:' + xpProgress + '%;border-radius:4px"></div></div><div style="font-size:13px;opacity:0.9">' + userData.xp + ' / ' + nextLevel.xp + ' XP</div></div></div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px"><div style="background:white;border-radius:16px;padding:20px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.06)"><div style="font-size:36px;font-weight:800;color:#667eea">' + userData.xp + '</div><div style="font-size:13px;color:#6b7280">XP gesamt</div></div><div style="background:white;border-radius:16px;padding:20px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.06)"><div style="font-size:36px;font-weight:800;color:#f59e0b">üî• ' + userData.streak + '</div><div style="font-size:13px;color:#6b7280">Tage Streak</div></div><div style="background:white;border-radius:16px;padding:20px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.06)"><div style="font-size:36px;font-weight:800;color:#8b5cf6">' + userData.dealsViewed + '</div><div style="font-size:13px;color:#6b7280">Deals angesehen</div></div><div style="background:white;border-radius:16px;padding:20px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.06)"><div style="font-size:36px;font-weight:800;color:#10b981">' + (userData.dealsSubmitted || 0) + '</div><div style="font-size:13px;color:#6b7280">Deals geteilt</div></div></div><div style="background:linear-gradient(135deg,#10b981,#059669);border-radius:16px;padding:20px;color:white"><div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:13px;opacity:0.9">üí∞ Gespart</div><div style="font-size:32px;font-weight:800;margin-top:4px">‚Ç¨' + (userData.savings || 0) + '</div></div><div style="text-align:right"><div style="font-size:13px;opacity:0.9">Ziel</div><div style="font-size:20px;font-weight:700">‚Ç¨50</div></div></div><div style="background:rgba(255,255,255,0.3);height:8px;border-radius:4px;margin-top:12px;overflow:hidden"><div style="background:white;height:100%;width:' + Math.min(100, ((userData.savings || 0) / 50) * 100) + '%;border-radius:4px"></div></div></div></div>'; document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.querySelectorAll('.nav-item')[2].classList.add('active'); }
        function showSecretDeals() { hideHeaderElements(); const canSpin = !userData.lastSpin || new Date().toDateString() !== new Date(userData.lastSpin).toDateString(); const challengeDone = userData.dealsViewed >= 5; document.getElementById('deals').innerHTML = '<div style="padding:4px 0"><div style="text-align:center;margin-bottom:16px"><div style="font-size:32px">üîÆ</div><h2 style="font-size:22px;margin:8px 0 4px">Geheime Deals</h2><p style="color:#6b7280;font-size:14px">Challenges & Bonus</p></div><div style="background:white;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06);border:2px solid ' + (challengeDone ? '#10b981' : '#fbbf24') + '"><div style="display:flex;align-items:center;gap:12px;margin-bottom:12px"><span style="font-size:32px">' + (challengeDone ? '‚úÖ' : 'üéØ') + '</span><div><div style="font-weight:700;font-size:16px">' + (challengeDone ? 'Challenge geschafft!' : 'T√§gliche Challenge') + '</div><div style="font-size:13px;color:#6b7280">Schau dir 5 Deals an</div></div></div><div style="display:flex;gap:8px;margin-bottom:12px"><div style="flex:1;height:8px;border-radius:4px;background:' + (userData.dealsViewed >= 1 ? 'linear-gradient(135deg,#10b981,#059669)' : '#e5e7eb') + '"></div><div style="flex:1;height:8px;border-radius:4px;background:' + (userData.dealsViewed >= 2 ? 'linear-gradient(135deg,#10b981,#059669)' : '#e5e7eb') + '"></div><div style="flex:1;height:8px;border-radius:4px;background:' + (userData.dealsViewed >= 3 ? 'linear-gradient(135deg,#10b981,#059669)' : '#e5e7eb') + '"></div><div style="flex:1;height:8px;border-radius:4px;background:' + (userData.dealsViewed >= 4 ? 'linear-gradient(135deg,#10b981,#059669)' : '#e5e7eb') + '"></div><div style="flex:1;height:8px;border-radius:4px;background:' + (userData.dealsViewed >= 5 ? 'linear-gradient(135deg,#10b981,#059669)' : '#e5e7eb') + '"></div></div><div style="font-size:13px;color:#6b7280;text-align:center">' + Math.min(userData.dealsViewed, 5) + '/5 Deals</div>' + (challengeDone ? '<div style="background:#d1fae5;color:#065f46;padding:10px;border-radius:10px;margin-top:12px;text-align:center;font-weight:600">üéÅ +25 XP!</div>' : '<div style="background:#fef3c7;padding:10px;border-radius:10px;margin-top:12px;text-align:center;font-size:13px;color:#92400e">üéÅ +25 XP Belohnung</div>') + '</div><div style="background:linear-gradient(135deg,#ec4899,#8b5cf6);border-radius:16px;padding:20px;color:white;margin-bottom:16px;text-align:center;cursor:pointer" onclick="openSpinModal()"><div style="font-size:48px;margin-bottom:8px">üé°</div><div style="font-size:18px;font-weight:700">T√§gliches Gl√ºcksrad</div><div style="font-size:14px;opacity:0.9;margin:8px 0">Drehe und gewinne XP!</div><button style="background:white;color:#8b5cf6;border:none;padding:12px 32px;border-radius:25px;font-weight:700;font-size:16px;cursor:pointer;margin-top:8px">' + (canSpin ? 'üé∞ Drehen!' : '‚úÖ Gedreht') + '</button></div><div style="background:linear-gradient(135deg,' + (challengeDone ? '#fbbf24,#f59e0b' : '#1f2937,#374151') + ');border-radius:16px;padding:20px;color:white;margin-bottom:16px"><div style="display:flex;align-items:center;gap:12px"><span style="font-size:32px">' + (challengeDone ? 'üéÅ' : 'üîí') + '</span><div><div style="font-size:18px;font-weight:700">' + (challengeDone ? 'Geheimer Deal!' : 'Geheimer Deal') + '</div><div style="font-size:13px;opacity:0.9">' + (challengeDone ? 'IKEA: Gratis Softeis!' : 'Challenge abschlie√üen') + '</div></div></div></div><div style="background:linear-gradient(135deg,#10b981,#059669);border-radius:16px;padding:20px;color:white;text-align:center;cursor:pointer" onclick="openLinkModal()"><div style="font-size:36px;margin-bottom:8px">üîó</div><div style="font-size:18px;font-weight:700">Deal einreichen</div><div style="font-size:14px;opacity:0.9;margin-top:4px">+100 XP!</div></div></div>'; document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.querySelectorAll('.nav-item')[1].classList.add('active'); }
        function showToast(msg) { const t = document.createElement('div'); t.className = 'toast'; t.textContent = msg; document.body.appendChild(t); setTimeout(() => t.remove(), 2000); }
        function searchFor(query) { document.getElementById('searchInput').value = query; searchQuery = query; document.getElementById('searchDropdown').classList.remove('show'); document.getElementById('clearBtn').classList.add('show'); renderDeals(); }
        function clearSearch(e) { e.stopPropagation(); document.getElementById('searchInput').value = ''; searchQuery = ''; document.getElementById('clearBtn').classList.remove('show'); renderDeals(); }
        function saveUserData() { localStorage.setItem('userData', JSON.stringify(userData)); }
        function showHome() { document.getElementById('streakBanner').style.display = 'flex'; document.getElementById('dailyDeal').style.display = 'block'; document.getElementById('savingsCard').style.display = 'block'; document.getElementById('searchBox').style.display = 'flex'; document.getElementById('filters').style.display = 'block'; renderDeals(); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.querySelector('.nav-item').classList.add('active'); }
        function hideHeaderElements() { document.getElementById('streakBanner').style.display = 'none'; document.getElementById('dailyDeal').style.display = 'none'; document.getElementById('savingsCard').style.display = 'none'; document.getElementById('searchBox').style.display = 'none'; document.getElementById('filters').style.display = 'none'; }
        
        // ===== LINK SUBMIT SYSTEM =====
        let currentLinkData = null;
        
        function openLinkModal() {
            document.getElementById('linkModal').classList.add('show');
            document.getElementById('linkInput').value = '';
            document.getElementById('linkPreview').classList.remove('show');
            document.getElementById('linkSubmitBtn').disabled = true;
            currentLinkData = null;
        }
        
        function closeLinkModal() {
            document.getElementById('linkModal').classList.remove('show');
        }
        
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('linkInput').value = text;
                previewLink();
            } catch (e) {
                showToast('üìã Bitte manuell einf√ºgen (Ctrl+V)');
            }
        }
        
        function previewLink() {
            const input = document.getElementById('linkInput').value.trim();
            const preview = document.getElementById('linkPreview');
            const submitBtn = document.getElementById('linkSubmitBtn');
            
            if (!input || !input.includes('.')) {
                preview.classList.remove('show');
                submitBtn.disabled = true;
                currentLinkData = null;
                return;
            }
            
            // Check if already submitted
            if (submittedLinks.includes(input)) {
                showToast('‚ö†Ô∏è Dieser Link wurde bereits eingereicht!');
                submitBtn.disabled = true;
                return;
            }
            
            // Parse the URL
            const linkData = parseDealLink(input);
            currentLinkData = linkData;
            
            // Update preview
            document.getElementById('previewLogo').textContent = linkData.logo;
            document.getElementById('previewBrand').textContent = linkData.brand;
            document.getElementById('previewTitle').textContent = linkData.title;
            document.getElementById('previewType').textContent = linkData.type.toUpperCase();
            
            preview.classList.add('show');
            submitBtn.disabled = false;
        }
        
        function parseDealLink(url) {
            const urlLower = url.toLowerCase();
            
            // Find matching brand
            let brand = { name: 'Unbekannt', logo: 'üéÅ', category: 'shopping' };
            for (const [key, value] of Object.entries(KNOWN_BRANDS)) {
                if (urlLower.includes(key)) {
                    brand = value;
                    break;
                }
            }
            
            // Detect deal type from URL keywords
            let type = 'rabatt';
            let title = 'Neuer Deal';
            
            const gratisKeywords = ['gratis', 'kostenlos', 'free', 'geschenk', 'umsonst', 'freebie', '0-euro', '0euro'];
            const rabattKeywords = ['rabatt', 'sale', 'prozent', 'aktion', 'angebot', 'deal', 'sparen', 'reduziert', 'gutschein', 'code', 'coupon'];
            
            if (gratisKeywords.some(k => urlLower.includes(k))) {
                type = 'gratis';
                title = 'Gratis-Angebot entdeckt!';
            } else if (rabattKeywords.some(k => urlLower.includes(k))) {
                type = 'rabatt';
                title = 'Rabatt-Deal entdeckt!';
            }
            
            // Try to extract more info from URL path
            const pathMatch = url.match(/\/([^\/\?]+)(?:\?|$)/);
            if (pathMatch) {
                const pathPart = pathMatch[1].replace(/[-_]/g, ' ').replace(/\.(html|php|aspx)/i, '');
                if (pathPart.length > 3 && pathPart.length < 50) {
                    title = pathPart.charAt(0).toUpperCase() + pathPart.slice(1);
                }
            }
            
            return {
                url: url,
                brand: brand.name,
                logo: brand.logo,
                category: brand.category,
                type: type,
                title: title,
                id: 'user-' + Date.now()
            };
        }
        
        function submitDealLink() {
            if (!currentLinkData) return;
            
            // Save the link as submitted
            submittedLinks.push(currentLinkData.url);
            localStorage.setItem('submittedLinks', JSON.stringify(submittedLinks));
            
            // Create new deal
            const newDeal = {
                id: currentLinkData.id,
                brand: currentLinkData.brand,
                logo: currentLinkData.logo,
                title: currentLinkData.title,
                description: 'üì± Von der Community entdeckt! √úberpr√ºfe den Deal auf der Website.',
                type: currentLinkData.type,
                category: currentLinkData.category,
                source: 'Community',
                url: currentLinkData.url,
                expires: 'Siehe Website',
                distance: 'Online',
                hot: true,
                isNew: true,
                isUserSubmitted: true,
                submittedAt: Date.now(),
                votes: 5
            };
            
            // Add to user deals
            userDeals.unshift(newDeal);
            localStorage.setItem('userDeals', JSON.stringify(userDeals));
            
            // Update stats
            userData.dealsSubmitted = (userData.dealsSubmitted || 0) + 1;
            saveUserData();
            
            // Close modal
            closeLinkModal();
            
            // Show success animation
            showSuccessAnimation();
            
            // Reload deals
            setTimeout(() => {
                loadDeals();
            }, 500);
        }
        
        function showSuccessAnimation() {
            const animation = document.getElementById('successAnimation');
            const rank = Math.max(1, 100 - (userData.dealsSubmitted || 1) * 3 - userData.level * 5);
            document.getElementById('userRank').textContent = rank;
            
            animation.classList.add('show');
            
            // Add XP with delay for effect
            setTimeout(() => {
                addXP(100, 'üéâ Deal eingereicht! Mega Belohnung!');
            }, 500);
            
            // Check for bonus
            if ((userData.dealsSubmitted || 0) === 1) {
                setTimeout(() => {
                    addXP(50, 'üèÜ Erster Deal eingereicht! Bonus!');
                }, 1500);
            } else if ((userData.dealsSubmitted || 0) % 5 === 0) {
                setTimeout(() => {
                    addXP(25, 'üéØ ' + userData.dealsSubmitted + ' Deals eingereicht! Bonus!');
                }, 1500);
            }
            
            // Hide after delay
            setTimeout(() => {
                animation.classList.remove('show');
            }, 3500);
        }
        
        document.getElementById('searchInput').addEventListener('focus', () => document.getElementById('searchDropdown').classList.add('show'));
        document.getElementById('searchInput').addEventListener('input', e => { searchQuery = e.target.value; document.getElementById('clearBtn').classList.toggle('show', searchQuery.length > 0); renderDeals(); });
        document.addEventListener('click', e => { if (!document.getElementById('searchBox').contains(e.target)) document.getElementById('searchDropdown').classList.remove('show'); });
        document.getElementById('typeFilters').addEventListener('click', e => { if (e.target.classList.contains('filter-btn')) { document.querySelectorAll('#typeFilters .filter-btn').forEach(b => b.classList.remove('active')); e.target.classList.add('active'); currentFilter = e.target.dataset.filter; renderDeals(); } });
        document.getElementById('categoryFilters').addEventListener('click', e => { if (e.target.classList.contains('filter-btn')) { document.querySelectorAll('#categoryFilters .filter-btn').forEach(b => b.classList.remove('active')); e.target.classList.add('active'); currentCategory = e.target.dataset.category; renderDeals(); } });
        window.addEventListener('scroll', () => document.getElementById('filters').classList.toggle('scrolled', window.scrollY > 100), { passive: true });
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
        
        init();
    </script>
</body>
</html>
